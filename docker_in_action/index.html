<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>Docker in Action</title>


<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/presentations/reveal-js/css/reset.css">
<link rel="stylesheet" href="/presentations/reveal-js/css/reveal.css"><link rel="stylesheet" href="/presentations/reveal-js/css/theme/night.css" id="theme">
<link rel="stylesheet" href="/presentations/highlight-js/github.min.css">
    
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
  

    <section><h2 id="docker-in-action">Docker in Action</h2>
<p>Let&rsquo;s learn docker by handson</p>



<aside class="notes"><ul>
<li>Docker handson session</li>
</ul>
</aside>
</section><section>
<h2 id="lets-get-to-know-docker-more-by-executing-cli-commands">Let&rsquo;s get to know docker more by executing cli commands</h2>
</section><section>
<h2 id="docker-commands">Docker Commands</h2>
</section><section>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker info</td>
<td>Display system-wide information</td>
<td>docker info</td>
</tr>
<tr>
<td>docker version</td>
<td>Show the Docker version information</td>
<td>docker version</td>
</tr>
<tr>
<td>docker pull</td>
<td>Pull an image or a repository from a registry</td>
<td>docker pull redis</td>
</tr>
<tr>
<td>docker images</td>
<td>List images</td>
<td>docker images</td>
</tr>
<tr>
<td>docker run</td>
<td>Run a command in a new container</td>
<td>docker run -d redis</td>
</tr>
</tbody>
</table>
</section><section>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker ps</td>
<td>List containers</td>
<td>docker ps</td>
</tr>
<tr>
<td>docker exec</td>
<td>Run a command in a running container</td>
<td>docker exec -it &lt;id/name&gt; sh</td>
</tr>
<tr>
<td>docker inspect</td>
<td>Return low-level information on Docker objects</td>
<td>docker inspect &lt;object id/name&gt;</td>
</tr>
<tr>
<td>docker  logs</td>
<td>Fetch the logs of a container</td>
<td>docker logs &lt;id/name&gt;</td>
</tr>
</tbody>
</table>
</section><section>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker  stats</td>
<td>Display a live stream of container(s) resource usage statistics</td>
<td>docker stats</td>
</tr>
<tr>
<td>docker network</td>
<td>Manage networks</td>
<td>docker network ls</td>
</tr>
<tr>
<td>docker rename</td>
<td>Rename a container</td>
<td>docker rename &lt;old&gt; &lt;new name&gt;</td>
</tr>
</tbody>
</table>
</section><section>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker  stop</td>
<td>Stop one or more running containers</td>
<td>docker stop &lt;id/name&gt;</td>
</tr>
<tr>
<td>docker  rm</td>
<td>Remove one or more containers</td>
<td>docker rm &lt;id/name&gt;</td>
</tr>
<tr>
<td>docker  rmi</td>
<td>Remove one or more images</td>
<td>docker rmi &lt;image id&gt;</td>
</tr>
</tbody>
</table>
</section><section>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker volume</td>
<td>Manage volumes</td>
<td>docker volume ls</td>
</tr>
<tr>
<td>docker  build</td>
<td>Build an image from a Dockerfile</td>
<td>dockr build . -t myapp:v1</td>
</tr>
</tbody>
</table>
</section><section>
<h2 id="command-help">Command Help</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">docker</span> [<span style="color:#a6e22e">command</span>] <span style="color:#f92672">--</span><span style="color:#a6e22e">help</span>
</code></pre></div><h3 id="example">Example</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>&gt; <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">exec</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">help</span>

<span style="color:#a6e22e">Usage</span>:	<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">exec</span> [<span style="color:#a6e22e">OPTIONS</span>] <span style="color:#a6e22e">CONTAINER</span> <span style="color:#a6e22e">COMMAND</span> [<span style="color:#a6e22e">ARG</span><span style="color:#f92672">...</span>]

<span style="color:#a6e22e">Run</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">command</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">container</span>

<span style="color:#a6e22e">Options</span>:
  <span style="color:#f92672">-</span><span style="color:#a6e22e">d</span>, <span style="color:#f92672">--</span><span style="color:#a6e22e">detach</span>               <span style="color:#a6e22e">Detached</span> <span style="color:#a6e22e">mode</span>: <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">command</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">background</span>
      <span style="color:#f92672">--</span><span style="color:#a6e22e">detach</span><span style="color:#f92672">-</span><span style="color:#a6e22e">keys</span> <span style="color:#66d9ef">string</span>   <span style="color:#a6e22e">Override</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">key</span> <span style="color:#a6e22e">sequence</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">detaching</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">container</span>
  <span style="color:#f92672">-</span><span style="color:#a6e22e">e</span>, <span style="color:#f92672">--</span><span style="color:#a6e22e">env</span> <span style="color:#a6e22e">list</span>             <span style="color:#a6e22e">Set</span> <span style="color:#a6e22e">environment</span> <span style="color:#a6e22e">variables</span>
  <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span>, <span style="color:#f92672">--</span><span style="color:#a6e22e">interactive</span>          <span style="color:#a6e22e">Keep</span> <span style="color:#a6e22e">STDIN</span> <span style="color:#a6e22e">open</span> <span style="color:#a6e22e">even</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">attached</span>
      <span style="color:#f92672">--</span><span style="color:#a6e22e">privileged</span>           <span style="color:#a6e22e">Give</span> <span style="color:#a6e22e">extended</span> <span style="color:#a6e22e">privileges</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">command</span>
  <span style="color:#f92672">-</span><span style="color:#a6e22e">t</span>, <span style="color:#f92672">--</span><span style="color:#a6e22e">tty</span>                  <span style="color:#a6e22e">Allocate</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">pseudo</span><span style="color:#f92672">-</span><span style="color:#a6e22e">TTY</span>
  <span style="color:#f92672">-</span><span style="color:#a6e22e">u</span>, <span style="color:#f92672">--</span><span style="color:#a6e22e">user</span> <span style="color:#66d9ef">string</span>          <span style="color:#a6e22e">Username</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">UID</span> (<span style="color:#a6e22e">format</span>: &lt;<span style="color:#a6e22e">name</span>|<span style="color:#a6e22e">uid</span>&gt;[:&lt;<span style="color:#a6e22e">group</span>|<span style="color:#a6e22e">gid</span>&gt;])
  <span style="color:#f92672">-</span><span style="color:#a6e22e">w</span>, <span style="color:#f92672">--</span><span style="color:#a6e22e">workdir</span> <span style="color:#66d9ef">string</span>       <span style="color:#a6e22e">Working</span> <span style="color:#a6e22e">directory</span> <span style="color:#a6e22e">inside</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">container</span>
</code></pre></div></section><section>
<h2 id="more-commands">More commands</h2>
<p><a href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a></p>
</section><section>
<h2 id="docker-volumes-usecase">Docker Volumes Usecase</h2>
<p>Jenkins</p>
</section><section>
<ul>
<li>Jenkins version updates</li>
<li>Plugin updates</li>
<li>Without losing configs/jobs you already have</li>
</ul>
</section><section>
<h2 id="docker-run-with-volumes">Docker run with volumes</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#ae81ff">8080</span>:<span style="color:#ae81ff">8080</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#ae81ff">50000</span>:<span style="color:#ae81ff">50000</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">v</span> <span style="color:#a6e22e">jenkins_home</span>:<span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">jenkins_home</span> <span style="color:#a6e22e">jenkins</span><span style="color:#f92672">/</span><span style="color:#a6e22e">jenkins</span>:<span style="color:#a6e22e">lts</span>
</code></pre></div><ul>
<li>
<p>This will store the workspace in /var/jenkins_home</p>
</li>
<li>
<p>All Jenkins data lives in there - including plugins and configuration</p>
</li>
<li>
<p>This will automatically create a &lsquo;jenkins_home&rsquo; docker volume on the host machine, that will survive the container stop/restart/deletion</p>
</li>
</ul>
</section><section>
<h2 id="view-docker-volume-created">View docker volume created</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker volume ls
</code></pre></div></section><section>
<h2 id="alpine-images">Alpine Images</h2>
<ul>
<li>
<p>Alpine Linux is a security-oriented, lightweight Linux distribution based on musl libc and busybox</p>
</li>
<li>
<p>Alpine image is only 5MB and has access to a package repository</p>
</li>
<li>
<p><a href="https://github.com/alpinelinux/docker-alpine">https://github.com/alpinelinux/docker-alpine</a></p>
</li>
</ul>
</section><section>
<h3 id="why-alpine-images">Why Alpine Images?</h3>
<ul>
<li>
<p>Docker images today are big</p>
</li>
<li>
<p>Usually much larger than they need to be</p>
</li>
<li>
<p>There are a lot of ways to make them smaller, but the Docker populace still jumps to the ubuntu base image for most projects</p>
</li>
<li>
<p>The size savings over ubuntu and other bases are huge:</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>REPOSITORY  TAG     IMAGE ID      CREATED      SIZE
alpine      latest  <span style="color:#ae81ff">961769676411</span>  <span style="color:#ae81ff">4</span> weeks ago  5.58MB
ubuntu      latest  2ca708c1c9cc  <span style="color:#ae81ff">2</span> days ago   64.2MB
debian      latest  c2c03a296d23  <span style="color:#ae81ff">9</span> days ago   114MB
centos      latest  67fa590cfc1c  <span style="color:#ae81ff">4</span> weeks ago  202MB
</code></pre></div></section><section>
<h3 id="alpine-based-images-vs-normal">Alpine based images vs normal</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>ruby  2.6.6            39853018958e      <span style="color:#ae81ff">13</span> days ago    840MB
ruby  2.6.6-alpine     d86341b50737      <span style="color:#ae81ff">5</span> weeks ago    49.8MB
</code></pre></div></section><section>
<h2 id="building-images">Building Images</h2>
</section><section>
<h2 id="dockerfile">Dockerfile</h2>
<ul>
<li>

<span class='fragment '
  >
  Docker can build images automatically by reading the instructions from a Dockerfile
</span></li>
<li>

<span class='fragment '
  >
  A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image
</span></li>
<li>

<span class='fragment '
  >
  Using docker build users can create an automated build that executes several command-line instructions in succession
</span></li>
</ul>
</section><section>
<h2 id="example-1">Example</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">ubuntu</span>

<span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">get</span> <span style="color:#a6e22e">update</span>
<span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">get</span> <span style="color:#a6e22e">install</span> <span style="color:#960050;background-color:#1e0010">–</span><span style="color:#a6e22e">y</span> <span style="color:#a6e22e">nginx</span>
<span style="color:#a6e22e">CMD</span> [<span style="color:#960050;background-color:#1e0010">“</span><span style="color:#a6e22e">echo</span><span style="color:#960050;background-color:#1e0010">”</span>,<span style="color:#960050;background-color:#1e0010">”</span><span style="color:#a6e22e">Image</span> <span style="color:#a6e22e">created</span><span style="color:#960050;background-color:#1e0010">”</span>]
</code></pre></div></section><section>
<h2 id="dockerfile-commands">Dockerfile Commands</h2>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>FROM</td>
<td>specify base image</td>
</tr>
<tr>
<td>RUN</td>
<td>execute commands</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>to configure a container that will run as an executable</td>
</tr>
<tr>
<td>CMD</td>
<td>provide defaults for an executing container</td>
</tr>
<tr>
<td>COPY</td>
<td>copies new files or directories</td>
</tr>
</tbody>
</table>
</section><section>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ENV</td>
<td>sets the environment variable</td>
</tr>
<tr>
<td>EXPOSE</td>
<td>informs Docker that the container listens on the specified network ports</td>
</tr>
<tr>
<td>USER</td>
<td>sets the user</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>sets the working directory</td>
</tr>
</tbody>
</table>
</section><section>
<h2 id="lets-build-images">Lets build images</h2>
<h3 id="from-terminalgit-bash">From terminal/git bash</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>git clone https://github.com/slashpai/docker_k8s_training.git
cd docker_k8s_training
cd docker_apps
</code></pre></div></section><section>
<h2 id="example-1-1">Example 1</h2>
<h3 id="simple-webapp">Simple WebApp</h3>
<p>cd simple_webapp</p>
<ul>
<li>


<span class='fragment '
  >
  A simple ruby web app using Sinatra
</span>
</li>
<li>


<span class='fragment '
  >
  Lets understand the app first
</span>
</li>
<li>


<span class='fragment '
  >
  Lets build the docker app from it
</span>
</li>
<li>


<span class='fragment '
  >
  docker build  . -t simple-webapp:v1
</span>
</li>
</ul>
</section><section>
<h3 id="run-docker-containers">Run docker containers</h3>
<ul>
<li>
<p>docker run -d -p 9000:4567 &ndash;name simple-webapp1 simple-webapp:v1</p>
</li>
<li>
<p>docker run -d -p 9001:4567 &ndash;name simple-webapp1 &ndash;env APP_COLOR=yellow simple-webapp:v1</p>
</li>
<li>
<p>docker run -d -p 9002:4567 &ndash;name simple-webapp2 &ndash;env APP_COLOR=orange simple-webapp:v1</p>
</li>
<li>
<p>Go to http://localhost:9000, http://localhost:9001 and http://localhost:9002</p>
</li>
</ul>
</section><section>
<h2 id="understanding-dockerfile">Understanding Dockerfile</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">ruby</span>:<span style="color:#ae81ff">2.6.6</span><span style="color:#f92672">-</span><span style="color:#a6e22e">alpine</span>

<span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">src</span><span style="color:#f92672">/</span><span style="color:#a6e22e">app</span>

<span style="color:#a6e22e">ENV</span> <span style="color:#a6e22e">APP_COLOR</span>=<span style="color:#e6db74">&#34;pink&#34;</span>

<span style="color:#a6e22e">COPY</span> <span style="color:#a6e22e">Gemfile</span> .<span style="color:#f92672">/</span>

<span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">gem</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">bundler</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">bundle</span> <span style="color:#a6e22e">install</span>

<span style="color:#a6e22e">COPY</span> . .

<span style="color:#a6e22e">EXPOSE</span> <span style="color:#ae81ff">4567</span>

<span style="color:#a6e22e">CMD</span> [ <span style="color:#e6db74">&#34;ruby&#34;</span>, <span style="color:#e6db74">&#34;app.rb&#34;</span> ]
</code></pre></div></section><section>
<h2 id="example-2">Example 2</h2>
<h3 id="ruby-calculator">Ruby Calculator</h3>
<p>cd calculator</p>
<ul>
<li>


<span class='fragment '
  >
  A simple ruby calaculator to show how we can use docker to run adhoc tasks
</span>
</li>
<li>


<span class='fragment '
  >
  Lets understand the app first
</span>
</li>
<li>


<span class='fragment '
  >
  Lets build the docker app from it
</span>
</li>
<li>


<span class='fragment '
  >
  docker build  . -t simple-calculator:v1
</span>
</li>
<li>


<span class='fragment '
  >
  docker run simple-calculator:v1 3 + 4
</span>
</li>
</ul>
</section><section>
<h2 id="review-the-container-created">Review the container created</h2>
<ul>
<li>

<span class='fragment '
  >
  docker ps
</span></li>
<li>

<span class='fragment '
  >
  docker ps -a
</span></li>
<li>

<span class='fragment '
  >
  Any reason why it doesn&rsquo;t show in running container list?
</span></li>
<li>

<span class='fragment '
  >
  Noticed the ENTRYPOINT in Dockerfile?
</span></li>
</ul>
</section><section>
<h2 id="understanding-dockerfile-1">Understanding Dockerfile</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">ruby</span>:<span style="color:#ae81ff">2.6.6</span><span style="color:#f92672">-</span><span style="color:#a6e22e">alpine</span>

<span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">src</span><span style="color:#f92672">/</span><span style="color:#a6e22e">app</span>

<span style="color:#a6e22e">COPY</span> . .

<span style="color:#a6e22e">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;ruby&#34;</span>, <span style="color:#e6db74">&#34;calculator.rb&#34;</span>]
</code></pre></div></section><section>
<h2 id="dockerignore-file">.dockerignore file</h2>
<ul>
<li>


<span class='fragment '
  >
  Before the docker CLI sends the context to the docker daemon, it looks for a file named .dockerignore in the root directory of the context
</span>
</li>
<li>


<span class='fragment '
  >
  If this file exists, the CLI modifies the context to exclude files and directories that match patterns in it
</span>
</li>
<li>


<span class='fragment '
  >
  This helps to avoid unnecessarily sending large or sensitive files and directories to the daemon and potentially adding them to images using ADD or COPY
</span>
</li>
</ul>
</section><section>
<h2 id="example-3">Example 3</h2>
<h3 id="quiz-app">Quiz App</h3>
<p>cd quiz_app</p>
<ul>
<li>


<span class='fragment '
  >
  A simple quiz app using node.js
</span>
</li>
<li>


<span class='fragment '
  >
  Noticed the .dockerignore file?
</span>
</li>
<li>


<span class='fragment '
  >
  Lets build the docker app from it
</span>
</li>
<li>


<span class='fragment '
  >
  docker build  . -t quiz-app:v1
</span>
</li>
</ul>
</section><section>
<h2 id="some-task-for-you">Some task for you</h2>
<ul>
<li>docker run -d -p 3500:3000 quiz-app:v1</li>
<li>Go to http://localhost:3500</li>
<li>Try the docker quiz 🤩</li>
</ul>
</section><section>
<h2 id="understanding-dockerfile-2">Understanding Dockerfile</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">node</span>:<span style="color:#ae81ff">15.3.0</span><span style="color:#f92672">-</span><span style="color:#a6e22e">alpine3</span><span style="color:#ae81ff">.10</span>

<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">app</span> <span style="color:#a6e22e">directory</span>
<span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">src</span><span style="color:#f92672">/</span><span style="color:#a6e22e">app</span>

<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Install</span> <span style="color:#a6e22e">app</span> <span style="color:#a6e22e">dependencies</span>
<span style="color:#a6e22e">COPY</span> <span style="color:#f92672">package</span><span style="color:#f92672">*</span>.<span style="color:#a6e22e">json</span> .<span style="color:#f92672">/</span>

<span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">npm</span> <span style="color:#a6e22e">install</span>

<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Bundle</span> <span style="color:#a6e22e">app</span> <span style="color:#a6e22e">source</span>
<span style="color:#a6e22e">COPY</span> . .

<span style="color:#a6e22e">EXPOSE</span> <span style="color:#ae81ff">3000</span>
<span style="color:#a6e22e">CMD</span> [ <span style="color:#e6db74">&#34;node&#34;</span>, <span style="color:#e6db74">&#34;index.js&#34;</span> ]
</code></pre></div></section><section>
<h3 id="cmd-vs-entrypoint">CMD vs ENTRYPOINT</h3>
<ul>
<li>


<span class='fragment '
  >
  CMD is an instruction that is best to use if you need a default command which users can easily override
</span>
</li>
<li>


<span class='fragment '
  >
  ENTRYPOINT is preferred when you want to define a container with a specific executable
</span>
</li>
<li>


<span class='fragment '
  >
  You cannot override an ENTRYPOINT when starting a container unless you add the &ndash;entrypoint flag
</span>
</li>
<li>


<span class='fragment '
  >
  Combine ENTRYPOINT with CMD if you need a container with a specified executable and a default parameter that can be modified easily
</span>
</li>
</ul>



<aside class="notes"><ul>
<li>
<p>If a Dockerfile has multiple CMDs, it only applies the instructions from the last one</p>
</li>
<li>
<p>For example, when containerizing an application use ENTRYPOINT and CMD to set environment-specific variables.</p>
</li>
</ul>
</aside>
</section><section>
<h3 id="explore-dockerfiles-of-some-of-the-official-images-available-in-docker-hub">Explore Dockerfiles of some of the official images available in docker hub</h3>
<p><a href="https://hub.docker.com/search?q=&amp;type=image&amp;image_filter=store%2Cofficial">https://hub.docker.com/search?q=&amp;type=image&amp;image_filter=store%2Cofficial</a></p>
</section><section>
<h2 id="docker-compose">Docker Compose</h2>
</section><section>
<ul>
<li>

<span class='fragment '
  >
  Compose is a tool for defining and running multi-container Docker applications
</span></li>
<li>

<span class='fragment '
  >
  With Compose, you use a YAML file to configure your application’s services
</span></li>
<li>

<span class='fragment '
  >
  Then, with a single command, you create and start all the services from your configuration
</span></li>
</ul>
</section><section>
<h3 id="commands">Commands</h3>
<p>docker-compose &lt;command&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>  <span style="color:#a6e22e">build</span>              <span style="color:#a6e22e">Build</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">rebuild</span> <span style="color:#a6e22e">services</span>
  <span style="color:#a6e22e">config</span>             <span style="color:#a6e22e">Validate</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">view</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Compose</span> <span style="color:#a6e22e">file</span>
  <span style="color:#a6e22e">create</span>             <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">services</span>
  <span style="color:#a6e22e">down</span>               <span style="color:#a6e22e">Stop</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">remove</span> <span style="color:#a6e22e">containers</span>, <span style="color:#a6e22e">networks</span>, <span style="color:#a6e22e">images</span>, <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">volumes</span>
  <span style="color:#a6e22e">exec</span>               <span style="color:#a6e22e">Execute</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">command</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">container</span>
  <span style="color:#a6e22e">help</span>               <span style="color:#a6e22e">Get</span> <span style="color:#a6e22e">help</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">command</span>
  <span style="color:#a6e22e">images</span>             <span style="color:#a6e22e">List</span> <span style="color:#a6e22e">images</span>
  <span style="color:#a6e22e">logs</span>               <span style="color:#a6e22e">View</span> <span style="color:#a6e22e">output</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">containers</span>
  <span style="color:#a6e22e">ps</span>                 <span style="color:#a6e22e">List</span> <span style="color:#a6e22e">containers</span>
  <span style="color:#a6e22e">restart</span>            <span style="color:#a6e22e">Restart</span> <span style="color:#a6e22e">services</span>
  <span style="color:#a6e22e">rm</span>                 <span style="color:#a6e22e">Remove</span> <span style="color:#a6e22e">stopped</span> <span style="color:#a6e22e">containers</span>
  <span style="color:#a6e22e">start</span>              <span style="color:#a6e22e">Start</span> <span style="color:#a6e22e">services</span>
  <span style="color:#a6e22e">stop</span>               <span style="color:#a6e22e">Stop</span> <span style="color:#a6e22e">services</span>
  <span style="color:#a6e22e">up</span>                 <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">start</span> <span style="color:#a6e22e">containers</span>
  <span style="color:#a6e22e">version</span>            <span style="color:#a6e22e">Show</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Compose</span> <span style="color:#a6e22e">version</span> <span style="color:#a6e22e">information</span>
</code></pre></div></section><section>
<h2 id="examples">Examples</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape><span style="color:#a6e22e">version</span>: <span style="color:#e6db74">&#34;3.7&#34;</span>

<span style="color:#a6e22e">services</span>:
  <span style="color:#a6e22e">prometheus</span>:
    <span style="color:#a6e22e">image</span>: <span style="color:#a6e22e">prom</span><span style="color:#f92672">/</span><span style="color:#a6e22e">prometheus</span>:<span style="color:#a6e22e">v2</span><span style="color:#ae81ff">.19.0</span>
    <span style="color:#a6e22e">container_name</span>: <span style="color:#a6e22e">prom</span>
    <span style="color:#a6e22e">ports</span>:
      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;9090:9090&#34;</span>
  <span style="color:#a6e22e">grafana</span>:
    <span style="color:#a6e22e">image</span>: <span style="color:#a6e22e">grafana</span><span style="color:#f92672">/</span><span style="color:#a6e22e">grafana</span>:<span style="color:#ae81ff">7.0.3</span>
    <span style="color:#a6e22e">container_name</span>: <span style="color:#a6e22e">grafana</span>
    <span style="color:#a6e22e">ports</span>:
      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;3000:3000&#34;</span>
</code></pre></div></section><section>
<h3 id="lets-try-docker-compose">Let&rsquo;s try docker-compose</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>cd to docker_k8s_training/docker-compose/monitoring
docker-compose up
</code></pre></div><p>Load http://localhost:3000 and http://localhost:9090</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>cd to docker_k8s_training/docker-compose/consul_cluster
docker-compose up
</code></pre></div><p>Load http://localhost:8500</p>
</section><section>
<h3 id="run-in-detached-modebackground">Run in detached mode/background</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker-compose up -d
</code></pre></div></section><section>
<h3 id="explore-docker-compose-commands">Explore docker-compose commands</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker-compose ps
docker-compose images
docker-compose stop
docker-compose rm
</code></pre></div></section><section>
<h2 id="read-more">Read More</h2>
<p><a href="https://docs.docker.com/compose/gettingstarted/">https://docs.docker.com/compose/gettingstarted/</a></p>
</section><section>
<h2 id="docker-image-layers-review">Docker Image Layers Review</h2>
<ul>
<li>Compare images docker history <a href="image:tag">image:tag</a></li>
</ul>
</section><section>
<h2 id="read-more-1">Read More</h2>
<p><a href="https://docs.docker.com/storage/storagedriver/">https://docs.docker.com/storage/storagedriver/</a></p>
</section><section>
<h2 id="clean-up-unused-containersimages">Clean Up Unused containers/images</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker stop
docker rm
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker images
docker rmi
</code></pre></div></section><section>
<h3 id="list-all-exited-containers">List all exited containers</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker ps -a -f status<span style="color:#f92672">=</span>exited
</code></pre></div><h3 id="remove-all-exited-containers">Remove all exited containers</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker rm <span style="color:#66d9ef">$(</span>docker ps -a -f status<span style="color:#f92672">=</span>exited -q<span style="color:#66d9ef">)</span>
</code></pre></div></section><section>
<h3 id="docker-images-cleanup">Docker Images Cleanup</h3>
<ul>
<li>
<p>Docker images consist of multiple layers. Dangling images are layers that have no relationship to any tagged images</p>
</li>
<li>
<p>They no longer serve a purpose and consume disk space</p>
</li>
<li>
<p>If you build an image without tagging it, the image will appear on the list of dangling images</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker images -f dangling<span style="color:#f92672">=</span>true
</code></pre></div></li>
<li>
<p>When you’re sure you want to delete them</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker image prune
</code></pre></div></li>
</ul>
</section><section>
<ul>
<li>
<p>To remove specific image</p>
<ul>
<li>
<p>You would require to first stop and remove container using the image before doing this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="nohighlight" data-noescape>docker rmi &lt;image id/name:tag&gt;
</code></pre></div></li>
</ul>
</li>
</ul>
</section><section>
<h2 id="read-more-2">Read More</h2>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-remove-docker-images-containers-and-volumes">https://www.digitalocean.com/community/tutorials/how-to-remove-docker-images-containers-and-volumes</a></p>
</section><section>
<h2 id="training-summary">Training Summary</h2>
<ul>
<li>
<p>Docker commands</p>
</li>
<li>
<p>Building docker applications and run it</p>
</li>
<li>
<p>Using Docker compose</p>
</li>
</ul>
</section><section>
<h2 id="what-next">What Next?</h2>
<ul>
<li>


<span class='fragment '
  >
  Want to learn something new without the pain of installing and messing up your machine?
</span>
</li>
<li>


<span class='fragment '
  >
  You know the answer how to solve that now 🤩
</span>
</li>
</ul>
</section>

  
<section data-noprocess data-shortcode-slide>
  <h1 id="thank-you">Thank you!</h1>
</section>
<section data-noprocess data-shortcode-slide>
  
<h1 id="any-questions">Any questions?</h1>

</section>

  


</div>
      

    </div>
<script type="text/javascript" src=/presentations/reveal-hugo/object-assign.js></script>

<a href="/presentations/reveal-js/css/print/" id="print-location" style="display: none;"></a>
<script type="text/javascript">
  var printLocationElement = document.getElementById('print-location');
  var link = document.createElement('link');
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = printLocationElement.href + (window.location.search.match(/print-pdf/gi) ? 'pdf.css' : 'paper.css');
  document.getElementsByTagName('head')[0].appendChild(link);
</script>

<script type="application/json" id="reveal-hugo-site-params">{"highlight_theme":"github","templates":{"blue":{"background":"#a5e2fd","transition":"slide-in fade-out"},"yellow":{"background":"#f6f195","transition":"slide-in fade-out"}}}</script>
<script type="application/json" id="reveal-hugo-page-params">{"margin":0.2,"theme":"night"}</script>

<script src="/presentations/reveal-js/js/reveal.js"></script>

<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }
  
  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams));
  Reveal.initialize(options);
</script>


  
  
  <script type="text/javascript" src="/presentations/reveal-js/plugin/markdown/marked.js"></script>
  
  <script type="text/javascript" src="/presentations/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/presentations/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/presentations/reveal-js/plugin/zoom-js/zoom.js"></script>
  
  
  <script type="text/javascript" src="/presentations/reveal-js/plugin/notes/notes.js"></script>



    
    
  </body>
</html>
